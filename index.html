# Enhanced Attendance System for Semester 3 Law Students

I've completely revamped the attendance system with a modern UI, improved functionality, and fixed the student attendance issue. Here's the enhanced version:

```html
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Kehadiran Semester 3 2025/2026</title>
  <!-- Add Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --success: #27ae60;
      --danger: #e74c3c;
      --warning: #f39c12;
      --info: #2980b9;
      --light: #ecf0f1;
      --dark: #2c3e50;
      --white: #ffffff;
      --gray: #95a5a6;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: var(--dark);
      line-height: 1.6;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* Login Card */
    .login-card {
      background: var(--white);
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      padding: 30px;
      margin: 40px auto;
      width: 100%;
      max-width: 500px;
      transition: transform 0.3s ease;
    }
    
    .login-card:hover {
      transform: translateY(-5px);
    }
    
    .logo-container {
      text-align: center;
      margin-bottom: 25px;
    }
    
    .logo {
      max-width: 120px;
      height: auto;
      border-radius: 50%;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .title {
      color: var(--primary);
      text-align: center;
      margin-bottom: 10px;
      font-size: 24px;
      font-weight: 700;
    }
    
    .subtitle {
      color: var(--gray);
      text-align: center;
      margin-bottom: 30px;
      font-size: 16px;
    }
    
    /* Form Styles */
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--dark);
    }
    
    .form-control {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #dfe6e9;
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.3s;
    }
    
    .form-control:focus {
      border-color: var(--secondary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }
    
    /* Dashboard Styles */
    .dashboard {
      display: none;
      animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid #dfe6e9;
    }
    
    .user-info {
      display: flex;
      align-items: center;
    }
    
    .avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: var(--secondary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: bold;
      margin-right: 15px;
    }
    
    .user-details h2 {
      font-size: 18px;
      margin-bottom: 5px;
    }
    
    .user-details p {
      font-size: 14px;
      color: var(--gray);
    }
    
    .logout-btn {
      background-color: var(--danger);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .logout-btn:hover {
      background-color: #c0392b;
    }
    
    /* Info Cards */
    .info-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .info-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s ease;
    }
    
    .info-card:hover {
      transform: translateY(-5px);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .card-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--dark);
    }
    
    .card-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }
    
    .card-icon.primary {
      background-color: var(--primary);
    }
    
    .card-icon.secondary {
      background-color: var(--secondary);
    }
    
    .card-icon.success {
      background-color: var(--success);
    }
    
    .card-icon.warning {
      background-color: var(--warning);
    }
    
    .card-value {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 5px;
    }
    
    .card-description {
      font-size: 14px;
      color: var(--gray);
    }
    
    /* Today's Schedule */
    .today-schedule {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      margin-bottom: 30px;
    }
    
    .section-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 20px;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .schedule-list {
      display: grid;
      gap: 15px;
    }
    
    .schedule-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      border-radius: 8px;
      background-color: #f8f9fa;
      transition: all 0.3s;
    }
    
    .schedule-item.active {
      background-color: rgba(52, 152, 219, 0.1);
      border-left: 4px solid var(--secondary);
    }
    
    .course-info {
      flex: 1;
    }
    
    .course-name {
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .course-time {
      font-size: 14px;
      color: var(--gray);
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .course-time.active {
      color: var(--secondary);
      font-weight: 600;
    }
    
    .attendance-status {
      width: 80px;
      text-align: center;
      font-weight: 600;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 14px;
    }
    
    .status-present {
      background-color: rgba(39, 174, 96, 0.1);
      color: var(--success);
    }
    
    .status-absent {
      background-color: rgba(231, 76, 60, 0.1);
      color: var(--danger);
    }
    
    .status-pending {
      background-color: rgba(243, 156, 18, 0.1);
      color: var(--warning);
    }
    
    .attendance-btn {
      background-color: var(--success);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .attendance-btn:hover {
      background-color: #219653;
    }
    
    .attendance-btn:disabled {
      background-color: #bdc3c7;
      cursor: not-allowed;
    }
    
    /* Attendance Table */
    .attendance-section {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      margin-bottom: 30px;
      overflow-x: auto;
    }
    
    .table-container {
      width: 100%;
      overflow-x: auto;
    }
    
    .attendance-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    
    .attendance-table th {
      background-color: var(--primary);
      color: white;
      padding: 12px 15px;
      text-align: left;
      font-weight: 600;
    }
    
    .attendance-table td {
      padding: 12px 15px;
      border-bottom: 1px solid #dfe6e9;
    }
    
    .attendance-table tr:hover {
      background-color: #f8f9fa;
    }
    
    .present {
      color: var(--success);
      font-weight: 600;
    }
    
    .absent {
      color: var(--danger);
      font-weight: 600;
    }
    
    .empty {
      color: var(--gray);
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      justify-content: flex-end;
    }
    
    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      border: none;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary {
      background-color: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background-color: #1a252f;
    }
    
    .btn-success {
      background-color: var(--success);
      color: white;
    }
    
    .btn-success:hover {
      background-color: #219653;
    }
    
    .btn-danger {
      background-color: var(--danger);
      color: white;
    }
    
    .btn-danger:hover {
      background-color: #c0392b;
    }
    
    .btn-warning {
      background-color: var(--warning);
      color: white;
    }
    
    .btn-warning:hover {
      background-color: #e67e22;
    }
    
    /* Meeting Info */
    .meeting-info {
      background: white;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .meeting-status {
      padding: 8px 15px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 14px;
    }
    
    .status-normal {
      background-color: rgba(41, 128, 185, 0.1);
      color: var(--info);
    }
    
    .status-exam {
      background-color: rgba(155, 89, 182, 0.1);
      color: #9b59b6;
    }
    
    .status-holiday {
      background-color: rgba(39, 174, 96, 0.1);
      color: var(--success);
    }
    
    .status-inactive {
      background-color: rgba(149, 165, 166, 0.1);
      color: var(--gray);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .info-cards {
        grid-template-columns: 1fr;
      }
      
      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .logout-btn {
        width: 100%;
        justify-content: center;
      }
    }
    
    /* Error Message */
    .error-message {
      color: var(--danger);
      text-align: center;
      margin-top: 15px;
      font-size: 14px;
      height: 20px;
    }
    
    /* Loading Spinner */
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background-color: white;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
      padding: 25px;
      box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
      animation: modalFadeIn 0.3s ease;
    }
    
    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--primary);
    }
    
    .close-modal {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--gray);
    }
    
    .modal-body {
      margin-bottom: 20px;
    }
    
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    /* Edit Mode */
    .edit-mode .editable {
      cursor: pointer;
      position: relative;
    }
    
    .edit-mode .editable:hover::after {
      content: 'Klik untuk mengubah';
      position: absolute;
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--dark);
      color: white;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
    }
    
    .edit-mode .editable:hover {
      background-color: rgba(52, 152, 219, 0.1);
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--gray);
    }
    
    .empty-icon {
      font-size: 50px;
      margin-bottom: 15px;
      color: #dfe6e9;
    }
    
    /* Stats */
    .stats {
      display: flex;
      gap: 15px;
      margin-top: 10px;
    }
    
    .stat-item {
      flex: 1;
      text-align: center;
      padding: 10px;
      border-radius: 8px;
      background-color: #f8f9fa;
    }
    
    .stat-value {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--gray);
      text-transform: uppercase;
      letter-spacing: 1px;
    }
  </style>
</head>
<body>
  <!-- Login Section -->
  <div class="container">
    <div class="login-card" id="loginBox">
      <div class="logo-container">
        <img class="logo" src="Logo.jpg" alt="Logo" />
      </div>
      <h1 class="title">ILMU HUKUM SEMESTER 3</h1>
      <p class="subtitle">Sistem Presensi Perkuliahan</p>
      
      <div class="meeting-info">
        <div id="datetime"></div>
        <div id="infoPertemuan" class="meeting-status"></div>
      </div>
      
      <div class="form-group">
        <label for="username" class="form-label">Username</label>
        <input type="text" id="username" class="form-control" placeholder="Masukkan username Anda">
      </div>
      
      <div class="form-group">
        <label for="password" class="form-label">Password</label>
        <input type="password" id="password" class="form-control" placeholder="Masukkan password Anda">
      </div>
      
      <button class="btn btn-primary" onclick="login()" style="width: 100%;">
        <i class="fas fa-sign-in-alt"></i> Masuk
      </button>
      
      <div id="loginError" class="error-message"></div>
    </div>
  </div>
  
  <!-- Dashboard Section -->
  <div class="container dashboard" id="dashboard">
    <div class="header">
      <div class="user-info">
        <div class="avatar" id="userAvatar">U</div>
        <div class="user-details">
          <h2 id="userGreeting"></h2>
          <p id="userRole"></p>
        </div>
      </div>
      <button class="logout-btn" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
    </div>
    
    <div class="meeting-info">
      <div id="datetimeAbsensi"></div>
      <div id="infoPertemuanAbsensi" class="meeting-status"></div>
    </div>
    
    <div class="info-cards" id="infoCards">
      <!-- Dynamic cards will be inserted here -->
    </div>
    
    <div class="today-schedule" id="todaySchedule">
      <h3 class="section-title">
        <i class="far fa-calendar-alt"></i> Jadwal Kuliah Hari Ini
      </h3>
      <div class="schedule-list" id="scheduleList">
        <!-- Dynamic schedule will be inserted here -->
      </div>
    </div>
    
    <div class="attendance-section">
      <h3 class="section-title">
        <i class="fas fa-clipboard-list"></i> Data Kehadiran
      </h3>
      <div id="attendanceTables">
        <!-- Dynamic tables will be inserted here -->
      </div>
    </div>
  </div>
  
  <!-- Modal for Attendance Confirmation -->
  <div class="modal" id="attendanceModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Konfirmasi Kehadiran</h3>
        <button class="close-modal" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body" id="modalBody">
        Anda yakin ingin menandai kehadiran untuk mata kuliah ini?
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" onclick="closeModal()">Batal</button>
        <button class="btn btn-success" onclick="confirmAttendance()">Konfirmasi</button>
      </div>
    </div>
  </div>

<script>
  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBjgyASzKxiOX-Lk-1f-ppad983GpAk6AE",
    authDomain: "absensi-perkuliahan.firebaseapp.com",
    projectId: "absensi-perkuliahan",
    storageBucket: "absensi-perkuliahan.appspot.com",
    messagingSenderId: "370507083773",
    appId: "1:370507083773:web:ddece366d8bdda9f943394",
    measurementId: "G-86T4ZV2LSD"
  };

  // Initialize Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();

  // Data pengguna
  const users = {
    // User admin
    admin: { 
      password: 'superadmin', 
      role: 'admin', 
      name: 'Administrator', 
      title: '',
      greeting: 'Admin'
    },
    
    // User mahasiswa
    david: { 
      password: 'david', 
      role: 'student', 
      name: 'David', 
      title: '', 
      nim: '50124802',
      greeting: 'Mahasiswa'
    },
    abdu: { 
      password: 'abdu', 
      role: 'student', 
      name: 'Abdu', 
      title: '', 
      nim: '50124803',
      greeting: 'Mahasiswa'
    },
    angga: { 
      password: 'angga', 
      role: 'student', 
      name: 'Angga', 
      title: '', 
      nim: '50124801',
      greeting: 'Mahasiswa'
    },
    
    // User dosen
    'pak agan': { 
      password: '123', 
      role: 'lecturer', 
      name: 'Agan Sutanto',
      title: 'S.H., M.H.',
      matkul: ['Hukum Dagang', 'Hukum Internasional', 'Hukum Agraria'],
      greeting: 'Pak'
    },
    'bu elvina': { 
      password: '123', 
      role: 'lecturer', 
      name: 'Elvina Melinda',
      title: 'S.H., M.H.',
      matkul: ['Hukum Administrasi Negara', 'Hukum Adat', 'Hukum Islam dan Waris'],
      greeting: 'Bu'
    },
    'bu lia': { 
      password: '123', 
      role: 'lecturer', 
      name: 'Kusroh Lailiyah',
      title: 'S.H., M.H.',
      matkul: ['Hukum Otonomi Daerah', 'Hukum Pajak'],
      greeting: 'Bu'
    }
  };

  // Data dosen untuk setiap mata kuliah
  const dosenMatkul = {
    "Hukum Administrasi Negara": "Elvina Melinda, S.H., M.H.",
    "Hukum Adat": "Elvina Melinda, S.H., M.H.",
    "Hukum Islam dan Waris": "Elvina Melinda, S.H., M.H.",
    "Hukum Dagang": "Agan Sutanto, S.H., M.H.",
    "Hukum Internasional": "Agan Sutanto, S.H., M.H.",
    "Hukum Agraria": "Agan Sutanto, S.H., M.H.",
    "Hukum Otonomi Daerah": "Kusroh Lailiyah, S.H., M.H.",
    "Hukum Pajak": "Kusroh Lailiyah, S.H., M.H."
  };

  // Fungsi untuk set waktu ke tengah malam
  function setToMidnight(date) {
    const d = new Date(date);
    d.setHours(0, 0, 0, 0);
    return d;
  }

  // Kalender Akademik Semester 3 Ilmu Hukum 2025/2026
  const pertemuanDates = [
    setToMidnight(new Date('2025-09-22')), // Pertemuan 1
    setToMidnight(new Date('2025-09-29')), // Pertemuan 2
    setToMidnight(new Date('2025-10-06')),
    setToMidnight(new Date('2025-10-13')),
    setToMidnight(new Date('2025-10-20')),
    setToMidnight(new Date('2025-10-27')),
    setToMidnight(new Date('2025-11-03')),
    setToMidnight(new Date('2025-11-10')),
    setToMidnight(new Date('2025-11-17')),
    setToMidnight(new Date('2025-11-24')),
    setToMidnight(new Date('2025-12-01')),
    setToMidnight(new Date('2025-12-08')),
    setToMidnight(new Date('2025-12-15')),
    setToMidnight(new Date('2025-12-22')),
    setToMidnight(new Date('2025-12-29')),
    setToMidnight(new Date('2026-01-05')), 
    setToMidnight(new Date('2026-01-12')),
    setToMidnight(new Date('2026-01-19')),
  ];

  const holidays = [
    // Libur Idul Fitri 10 Oktober - 24 Oktober
    ...Array.from({ length: 14 }, (_, i) => ({
      date: setToMidnight(new Date(2025, 9, 10 + i)),
      name: 'Libur Idul Fitri'
    })),
    { date: setToMidnight(new Date('2025-09-05')), name: 'Maulid Nabi Muhammad SAW' },
    { date: setToMidnight(new Date('2025-12-25')), name: 'Hari Natal' },
    { date: setToMidnight(new Date('2026-01-01')), name: 'Tahun Baru 2026 Masehi' },
    { date: setToMidnight(new Date('2026-01-16')), name: 'Isra Miraj' }
  ];

  const specialWeeks = {
    8: {
      startDate: setToMidnight(new Date('2025-11-10')),
      endDate: setToMidnight(new Date('2025-11-14')),
      name: 'Ujian Tengah Semester'
    },
    16: {
      startDate: setToMidnight(new Date('2026-01-05')),
      endDate: setToMidnight(new Date('2026-01-09')),
      name: 'Ujian Akhir Semester'
    }
  };

  // Jadwal mata kuliah berdasarkan hari (0=Minggu, 1=Senin, ..., 6=Sabtu) beserta jam
  const jadwalKuliah = {
    1: [ // Senin
      { nama: "Hukum Administrasi Negara", jam: "13:00 - 14:00" },
      { nama: "Hukum Adat", jam: "14:10 - 15:00" }
    ],
    2: [ // Selasa
      { nama: "Hukum Islam dan Waris", jam: "13:00 - 14:00" },
      { nama: "Hukum Dagang", jam: "14:10 - 15:00" }
    ],
    3: [ // Rabu
      { nama: "Hukum Internasional", jam: "08:30 - 10:00" },
      { nama: "Hukum Agraria", jam: "10:10 - 12:00" }
    ],
    4: [ // Kamis
      { nama: "Hukum Pajak", jam: "09:30 - 15:30" },
      { nama: "Hukum Otonomi Daerah", jam: "09:30 - 15:30" }
    ],
    5: [], // Jumat (tidak ada kelas)
    6: [], // Sabtu (tidak ada kelas)
    0: []  // Minggu (tidak ada kelas)
  };

  const semuaMataKuliah = [
    "Hukum Administrasi Negara",
    "Hukum Adat",
    "Hukum Islam dan Waris",
    "Hukum Dagang",
    "Hukum Internasional",
    "Hukum Agraria",
    "Hukum Otonomi Daerah",
    "Hukum Pajak"
  ];

  // Global variables
  let currentUser = null;
  let currentWeek = null;
  let isEditing = false;
  let originalAttendanceData = {};
  let currentMatkulForAttendance = null;
  let attendanceData = {};

  // Fungsi untuk memeriksa apakah waktu saat ini berada dalam jam kuliah
  function isWaktuKuliah(jamKuliah) {
    const now = new Date();
    const [startTime, endTime] = jamKuliah.split(' - ');
    
    const [startHour, startMinute] = startTime.split(':').map(Number);
    const [endHour, endMinute] = endTime.split(':').map(Number);
    
    const startDate = new Date();
    startDate.setHours(startHour, startMinute, 0, 0);
    
    const endDate = new Date();
    endDate.setHours(endHour, endMinute, 0, 0);
    
    return now >= startDate && now <= endDate;
  }

  // Fungsi untuk memperbarui tanggal dan waktu
  function updateDateTime() {
    const now = new Date();
    const hari = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
    const namaHari = hari[now.getDay()];
    const tanggal = now.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
    const jam = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    
    const dateTimeStr = `${namaHari}, ${tanggal} | ${jam}`;
    document.getElementById('datetime').textContent = dateTimeStr;
    
    const pertemuanInfo = hitungPertemuan();
    const infoPertemuanElement = document.getElementById('infoPertemuan');
    infoPertemuanElement.textContent = pertemuanInfo.status;
    
    // Update kelas status berdasarkan jenis pertemuan
    infoPertemuanElement.className = 'meeting-status';
    if (pertemuanInfo.isHoliday) {
      infoPertemuanElement.classList.add('status-holiday');
    } else if (pertemuanInfo.isExam) {
      infoPertemuanElement.classList.add('status-exam');
    } else if (pertemuanInfo.isActive) {
      infoPertemuanElement.classList.add('status-normal');
    } else {
      infoPertemuanElement.classList.add('status-inactive');
    }
    
    if(document.getElementById('dashboard').style.display !== 'none') {
      document.getElementById('datetimeAbsensi').textContent = dateTimeStr;
      const infoPertemuanAbsensiElement = document.getElementById('infoPertemuanAbsensi');
      infoPertemuanAbsensiElement.textContent = pertemuanInfo.status;
      
      // Update kelas status untuk dashboard
      infoPertemuanAbsensiElement.className = 'meeting-status';
      if (pertemuanInfo.isHoliday) {
        infoPertemuanAbsensiElement.classList.add('status-holiday');
      } else if (pertemuanInfo.isExam) {
        infoPertemuanAbsensiElement.classList.add('status-exam');
      } else if (pertemuanInfo.isActive) {
        infoPertemuanAbsensiElement.classList.add('status-normal');
      } else {
        infoPertemuanAbsensiElement.classList.add('status-inactive');
      }
    }
    
    currentWeek = pertemuanInfo.pertemuan;
    return pertemuanInfo;
  }

  // Fungsi untuk menghitung pertemuan
  function hitungPertemuan() {
    const today = setToMidnight(new Date());

    // Cek libur nasional dulu
    const libur = holidays.find(h => h.date.getTime() === today.getTime());
    if (libur) {
      return {
        pertemuan: null,
        status: `Libur Nasional: ${libur.name}`,
        isHoliday: true,
        isExam: false,
        isActive: false
      };
    }

    // Cek apakah sebelum atau setelah masa kuliah
    if (today < pertemuanDates[0]) {
      return {
        pertemuan: null,
        status: `Belum masuk periode perkuliahan (Mulai ${pertemuanDates[0].toLocaleDateString()})`,
        isHoliday: false,
        isExam: false,
        isActive: false
      };
    }

    if (today > pertemuanDates[pertemuanDates.length - 1]) {
      return {
        pertemuan: null,
        status: `Perkuliahan telah berakhir (Sampai ${pertemuanDates[pertemuanDates.length - 1].toLocaleDateString()})`,
        isHoliday: false,
        isExam: false,
        isActive: false
      };
    }

    // Cari minggu ke berapa hari ini termasuk
    let mingguKe = null;
    for (let i = pertemuanDates.length - 1; i >= 0; i--) {
      if (today >= pertemuanDates[i]) {
        mingguKe = i + 1;
        break;
      }
    }

    // Cek apakah minggu ini termasuk minggu khusus UTS/UAS
    for (const [nomor, info] of Object.entries(specialWeeks)) {
      if (today >= info.startDate && today <= info.endDate) {
        return {
          pertemuan: parseInt(nomor),
          status: `${info.name} (Minggu ke-${nomor})`,
          isHoliday: false,
          isExam: true,
          isActive: true
        };
      }
    }

    // Jika minggu ke tidak ditemukan, berarti bukan hari pertemuan
    if (mingguKe === null) {
      return {
        pertemuan: null,
        status: "Bukan hari perkuliahan",
        isHoliday: false,
        isExam: false,
        isActive: false
      };
    }

return {
  pertemuan: mingguKe,
  status: `Pertemuan ke-${mingguKe}`,
  isHoliday: false,
  isExam: false,
  isActive: true
};
}

// Fungsi untuk mengambil data absensi dari Firebase
async function getAttendanceData() {
try {
const snapshot = await db.collection('attendance').get();
const data = {};
snapshot.forEach(doc => {
data[doc.id] = doc.data();
});
attendanceData = data; // Simpan ke variabel global
return data;
} catch (error) {
console.error("Error getting attendance data:", error);
return {};
}
}

// Fungsi untuk menyimpan data absensi ke Firebase
async function saveAttendanceToFirebase(studentId, matkul, pertemuan, status) {
try {
const docRef = db.collection('attendance').doc(studentId);
const doc = await docRef.get();
   if (!doc.exists) {
    // Create new document if doesn't exist
    await docRef.set({
      [matkul]: {
        hadir: status === 'hadir' ? [pertemuan] : [],
        tidakHadir: status === 'tidakHadir' ? [pertemuan] : []
      }
    });
  } else {
    // Update existing document
    const data = doc.data();
    const matkulData = data[matkul] || { hadir: [], tidakHadir: [] };
    
    // Remove from both arrays first to avoid duplicates
    const newHadir = matkulData.hadir.filter(p => p !== pertemuan);
    const newTidakHadir = matkulData.tidakHadir.filter(p => p !== pertemuan);
    
    // Add to the correct array
    if (status === 'hadir') {
      newHadir.push(pertemuan);
    } else if (status === 'tidakHadir') {
      newTidakHadir.push(pertemuan);
    }
    
    await docRef.update({
      [matkul]: {
        hadir: newHadir,
        tidakHadir: newTidakHadir
      }
    });
  }
  return true;
} catch (error) {
  console.error("Error saving attendance:", error);
  return false;
}
}

// Fungsi untuk menampilkan modal konfirmasi absensi
function showAttendanceModal(matkul) {
currentMatkulForAttendance = matkul;
document.getElementById('modalBody').textContent =
Anda yakin ingin menandai kehadiran untuk ${matkul} pertemuan ke-${currentWeek}?;
document.getElementById('attendanceModal').style.display = 'flex';
}

// Fungsi untuk menutup modal
function closeModal() {
document.getElementById('attendanceModal').style.display = 'none';
}

// Fungsi untuk konfirmasi absensi
async function confirmAttendance() {
if (!currentWeek || !currentMatkulForAttendance) {
alert('Tidak dalam periode perkuliahan saat ini');
closeModal();
return;
}

text
const success = await saveAttendanceToFirebase(
  currentUser.toLowerCase(), 
  currentMatkulForAttendance, 
  currentWeek, 
  'hadir'
);

if (success) {
  alert('Kehadiran berhasil dicatat');
  closeModal();
  showDashboard(currentUser);
} else {
  alert('Gagal mencatat kehadiran');
}
}

// Fungsi untuk mengedit kehadiran (dosen)
function startEditAttendance() {
isEditing = true;
originalAttendanceData = JSON.parse(JSON.stringify(attendanceData));

text
// Add edit mode class to tables
document.getElementById('attendanceTables').classList.add('edit-mode');

// Show save and cancel buttons
const actionButtons = document.createElement('div');
actionButtons.className = 'action-buttons';
actionButtons.innerHTML = `
  <button class="btn btn-success" onclick="saveEditedAttendance()">
    <i class="fas fa-save"></i> Simpan Perubahan
  </button>
  <button class="btn btn-danger" onclick="cancelEditAttendance()">
    <i class="fas fa-times"></i> Batal
  </button>
`;
document.getElementById('attendanceTables').appendChild(actionButtons);
}

// Fungsi untuk toggle status kehadiran saat edit
function toggleAttendance(e) {
if (!isEditing) return;

text
const cell = e.target.closest('.editable');
if (!cell) return;

const row = cell.parentElement;
const studentId = row.getAttribute('data-student-id');
const matkul = row.closest('table').getAttribute('data-matkul');
const pertemuan = parseInt(cell.getAttribute('data-pertemuan'));

if (cell.textContent === "✔️") {
  cell.textContent = "❌";
  updateLocalAttendance(studentId, matkul, pertemuan, 'tidakHadir');
} else if (cell.textContent === "❌") {
  cell.textContent = "";
  updateLocalAttendance(studentId, matkul, pertemuan, null);
} else {
  cell.textContent = "✔️";
  updateLocalAttendance(studentId, matkul, pertemuan, 'hadir');
}
}

// Fungsi untuk update data absensi lokal saat edit
function updateLocalAttendance(studentId, matkul, pertemuan, status) {
if (!attendanceData[studentId]) {
attendanceData[studentId] = {};
}

text
if (!attendanceData[studentId][matkul]) {
  attendanceData[studentId][matkul] = { hadir: [], tidakHadir: [] };
}

// Remove from both arrays first
attendanceData[studentId][matkul].hadir = 
  attendanceData[studentId][matkul].hadir.filter(p => p !== pertemuan);
attendanceData[studentId][matkul].tidakHadir = 
  attendanceData[studentId][matkul].tidakHadir.filter(p => p !== pertemuan);

// Add to the correct array if status is provided
if (status === 'hadir') {
  attendanceData[studentId][matkul].hadir.push(pertemuan);
} else if (status === 'tidakHadir') {
  attendanceData[studentId][matkul].tidakHadir.push(pertemuan);
}
}

// Fungsi untuk menyimpan perubahan kehadiran
async function saveEditedAttendance() {
const changes = [];

text
// Compare original and modified data to find changes
for (const studentId in attendanceData) {
  for (const matkul in attendanceData[studentId]) {
    // Check if this matkul exists in original data
    const originalMatkulData = originalAttendanceData[studentId]?.[matkul] || { hadir: [], tidakHadir: [] };
    const modifiedMatkulData = attendanceData[studentId][matkul];
    
    // Combine all meetings from both arrays
    const allMeetings = new Set([
      ...originalMatkulData.hadir,
      ...originalMatkulData.tidakHadir,
      ...modifiedMatkulData.hadir,
      ...modifiedMatkulData.tidakHadir
    ]);
    
    // Check each meeting for changes
    for (const pertemuan of allMeetings) {
      const wasPresent = originalMatkulData.hadir.includes(pertemuan);
      const wasAbsent = originalMatkulData.tidakHadir.includes(pertemuan);
      const isPresent = modifiedMatkulData.hadir.includes(pertemuan);
      const isAbsent = modifiedMatkulData.tidakHadir.includes(pertemuan);
      
      // If status changed
      if ((wasPresent && !isPresent) || (wasAbsent && !isAbsent) {
        changes.push({
          studentId,
          matkul,
          pertemuan,
          status: isPresent ? 'hadir' : isAbsent ? 'tidakHadir' : null
        });
      } else if (!wasPresent && !wasAbsent && (isPresent || isAbsent)) {
        changes.push({
          studentId,
          matkul,
          pertemuan,
          status: isPresent ? 'hadir' : 'tidakHadir'
        });
      }
    }
  }
}

// Save all changes to Firebase
try {
  for (const change of changes) {
    await saveAttendanceToFirebase(
      change.studentId,
      change.matkul,
      change.pertemuan,
      change.status
    );
  }
  alert('Perubahan kehadiran berhasil disimpan');
  isEditing = false;
  showDashboard(currentUser);
} catch (error) {
  console.error("Error saving changes:", error);
  alert('Gagal menyimpan perubahan');
}
}

// Fungsi untuk membatalkan edit
function cancelEditAttendance() {
isEditing = false;
showDashboard(currentUser);
}

// Fungsi Login
async function login() {
const user = document.getElementById('username').value.trim();
const pass = document.getElementById('password').value.trim();
const loginError = document.getElementById('loginError');

text
if(users[user.toLowerCase()] && users[user.toLowerCase()].password === pass) {
  loginError.textContent = '';
  currentUser = user.toLowerCase();
  showDashboard(currentUser);
} else {
  loginError.textContent = 'Username atau password salah!';
}
}

function logout() {
document.getElementById('loginBox').style.display = 'block';
document.getElementById('dashboard').style.display = 'none';
document.getElementById('username').value = '';
document.getElementById('password').value = '';
currentUser = null;
}

// Fungsi untuk menampilkan info cards berdasarkan role
function renderInfoCards(userRole) {
const infoCardsContainer = document.getElementById('infoCards');
infoCardsContainer.innerHTML = '';

text
if (userRole === 'admin') {
  // Admin dashboard cards
  infoCardsContainer.innerHTML = `
    <div class="info-card">
      <div class="card-header">
        <h3 class="card-title">Total Mahasiswa</h3>
        <div class="card-icon primary">
          <i class="fas fa-users"></i>
        </div>
      </div>
      <div class="card-value">${Object.values(users).filter(u => u.role === 'student').length}</div>
      <div class="card-description">Terdaftar di sistem</div>
    </div>
    
    <div class="info-card">
      <div class="card-header">
        <h3 class="card-title">Total Dosen</h3>
        <div class="card-icon secondary">
          <i class="fas fa-chalkboard-teacher"></i>
        </div>
      </div>
      <div class="card-value">${Object.values(users).filter(u => u.role === 'lecturer').length}</div>
      <div class="card-description">Pengajar aktif</div>
    </div>
    
    <div class="info-card">
      <div class="card-header">
        <h3 class="card-title">Mata Kuliah</h3>
        <div class="card-icon success">
          <i class="fas fa-book"></i>
        </div>
      </div>
      <div class="card-value">${semuaMataKuliah.length}</div>
      <div class="card-description">Semester 3</div>
    </div>
    
    <div class="info-card">
      <div class="card-header">
        <h3 class="card-title">Pertemuan</h3>
        <div class="card-icon warning">
          <i class="fas fa-calendar-alt"></i>
        </div>
      </div>
      <div class="card-value">${currentWeek || '-'}</div>
      <div class="card-description">${currentWeek ? `ke-${currentWeek}` : 'Tidak aktif'}</div>
    </div>
  `;
} else if (userRole === 'lecturer') {
  // Lecturer dashboard cards
  const userData = users[currentUser];
  const totalMatkul = Array.isArray(userData.matkul) ? userData.matkul.length : 1;
  
  infoCardsContainer.innerHTML = `
    <div class="info-card">
      <div class="card-header">
        <h3 class="card-title">Mata Kuliah</h3>
        <div class="card-icon primary">
          <i class="fas fa-book"></i>
        </div>
      </div>
      <div class="card-value">${totalMatkul}</div>
      <div class="card-description">Yang diampu</div>
    </div>
    
    <div class="info-card">
      <div class="card-header">
        <h3 class="card-title">Mahasiswa</h3>
        <div class="card-icon secondary">
          <i class="fas fa-users"></i>
        </div>
      </div>
      <div class="card-value">${Object.values(users).filter(u => u.role === 'student').length}</div>
      <div class="card-description">Total mahasiswa</div>
    </div>
    
    <div class="info-card">
      <div class="card-header">
        <h3 class="card-title">Pertemuan</h3>
        <div class="card-icon success">
          <i class="fas fa-calendar-alt"></i>
        </div>
      </div>
      <div class="card-value">${currentWeek || '-'}</div>
      <div class="card-description">${currentWeek ? `ke-${currentWeek}` : 'Tidak aktif'}</div>
    </div>
  `;
} else {
  // Student dashboard cards
  const userData = users[currentUser];
  const totalHadir = calculateStudentAttendance(userData.nim).totalHadir;
  const totalPertemuan = semuaMataKuliah.length * 16; // 16 pertemuan per matkul
  
  infoCardsContainer.innerHTML = `
    <div class="info-card">
      <div class="card-header">
        <h3 class="card-title">Kehadiran</h3>
        <div class="card-icon primary">
          <i class="fas fa-check-circle"></i>
        </div>
      </div>
      <div class="card-value">${totalHadir}</div>
      <div class="card-description">Total hadir</div>
    </div>
    
    <div class="info-card">
      <div class="card-header">
        <h3 class="card-title">Mata Kuliah</h3>
        <div class="card-icon secondary">
          <i class="fas fa-book"></i>
        </div>
      </div>
      <div class="card-value">${semuaMataKuliah.length}</div>
      <div class="card-description">Semester ini</div>
    </div>
    
    <div class="info-card">
      <div class="card-header">
        <h3 class="card-title">Pertemuan</h3>
        <div class="card-icon success">
          <i class="fas fa-calendar-alt"></i>
        </div>
      </div>
      <div class="card-value">${currentWeek || '-'}</div>
      <div class="card-description">${currentWeek ? `ke-${currentWeek}` : 'Tidak aktif'}</div>
    </div>
  `;
}
}

// Fungsi untuk menghitung total kehadiran mahasiswa
function calculateStudentAttendance(nim) {
let totalHadir = 0;
let totalTidakHadir = 0;

text
const studentData = attendanceData[nim.toLowerCase()] || {};

for (const matkul in studentData) {
  totalHadir += studentData[matkul].hadir.length;
  totalTidakHadir += studentData[matkul].tidakHadir.length;
}

return { totalHadir, totalTidakHadir };
}

// Fungsi untuk menampilkan jadwal hari ini
function renderTodaySchedule(userRole) {
const hariIni = new Date().getDay();
const matkulHariIni = jadwalKuliah[hariIni];
const scheduleList = document.getElementById('scheduleList');

text
scheduleList.innerHTML = '';

if(matkulHariIni.length === 0) {
  scheduleList.innerHTML = `
    <div class="empty-state">
      <div class="empty-icon">
        <i class="far fa-calendar-times"></i>
      </div>
      <h3>Tidak ada jadwal kuliah hari ini</h3>
    </div>
  `;
} else {
  matkulHariIni.forEach(matkul => {
    const isBerjalan = isWaktuKuliah(matkul.jam);
    const studentAttendance = attendanceData[currentUser]?.[matkul.nama] || { hadir: [], tidakHadir: [] };
    const isPresent = studentAttendance.hadir.includes(currentWeek);
    const isAbsent = studentAttendance.tidakHadir.includes(currentWeek);
    
    const scheduleItem = document.createElement('div');
    scheduleItem.className = `schedule-item ${isBerjalan ? 'active' : ''}`;
    
    let statusElement = '';
    if (userRole === 'student') {
      if (isPresent) {
        statusElement = `<div class="attendance-status status-present">Hadir</div>`;
      } else if (isAbsent) {
        statusElement = `<div class="attendance-status status-absent">Tidak Hadir</div>`;
      } else if (currentWeek && isBerjalan) {
        statusElement = `
          <button class="attendance-btn" onclick="showAttendanceModal('${matkul.nama}')">
            <i class="fas fa-fingerprint"></i> Absen
          </button>
        `;
      } else if (currentWeek) {
        statusElement = `<div class="attendance-status status-pending">Belum Absen</div>`;
      } else {
        statusElement = `<div class="attendance-status status-pending">-</div>`;
      }
    } else {
      statusElement = `<div class="attendance-status">${matkul.jam}</div>`;
    }
    
    scheduleItem.innerHTML = `
      <div class="course-info">
        <div class="course-name">${matkul.nama}</div>
        <div class="course-time ${isBerjalan ? 'active' : ''}">
          <i class="far fa-clock"></i> ${matkul.jam}
        </div>
      </div>
      ${statusElement}
    `;
    
    scheduleList.appendChild(scheduleItem);
  });
}
}

// Fungsi untuk menampilkan tabel absensi
function renderAttendanceTables(userRole) {
const attendanceTables = document.getElementById('attendanceTables');
attendanceTables.innerHTML = '';
attendanceTables.classList.remove('edit-mode');

text
// Remove existing action buttons if any
const existingButtons = document.querySelector('.action-buttons');
if (existingButtons) existingButtons.remove();

if (userRole === 'admin') {
  // Tampilan untuk admin - semua data
  semuaMataKuliah.forEach(matkul => {
    const tableContainer = document.createElement('div');
    tableContainer.className = 'table-container';
    
    const tableTitle = document.createElement('h4');
    tableTitle.textContent = `${matkul} - Dosen: ${dosenMatkul[matkul]}`;
    tableTitle.style.margin = '20px 0 10px';
    tableTitle.style.color = 'var(--primary)';
    
    const table = document.createElement('table');
    table.className = 'attendance-table';
    table.setAttribute('data-matkul', matkul);
    
    const thead = document.createElement('thead');
    thead.innerHTML = `
      <tr>
        <th>Nama Mahasiswa</th>
        ${Array.from({length: 16}, (_, i) => `<th>${i+1}</th>`).join('')}
      </tr>
    `;
    
    const tbody = document.createElement('tbody');
    
    Object.keys(users).forEach(username => {
      if (users[username].role === 'student') {
        const row = document.createElement('tr');
        row.setAttribute('data-student-id', username);
        
        const nameCell = document.createElement('td');
        nameCell.textContent = users[username].name;
        row.appendChild(nameCell);
        
        const hadirArr = attendanceData[username]?.[matkul]?.hadir || [];
        const tidakHadirArr = attendanceData[username]?.[matkul]?.tidakHadir || [];
        
        for(let p=1; p<=16; p++){
          const cell = document.createElement('td');
          cell.setAttribute('data-pertemuan', p);
          
          if(hadirArr.includes(p)){
            cell.textContent = "✔️";
            cell.className = 'present';
          } else if(tidakHadirArr.includes(p)){
            cell.textContent = "❌";
            cell.className = 'absent';
          } else {
            cell.textContent = "";
            cell.className = 'empty';
          }
          
          if (isEditing) {
            cell.classList.add('editable');
          }
          
          row.appendChild(cell);
        }
        
        tbody.appendChild(row);
      }
    });
    
    table.appendChild(thead);
    table.appendChild(tbody);
    tableContainer.appendChild(tableTitle);
    tableContainer.appendChild(table);
    attendanceTables.appendChild(tableContainer);
  });
  
  // Add edit button for admin
  if (!isEditing) {
    const editButton = document.createElement('button');
    editButton.className = 'btn btn-warning';
    editButton.style.marginTop = '20px';
    editButton.innerHTML = '<i class="fas fa-edit"></i> Edit Kehadiran';
    editButton.onclick = startEditAttendance;
    attendanceTables.appendChild(editButton);
  }
} else if (userRole === 'lecturer') {
  // Tampilan untuk dosen - hanya matkul yang diampu
  const userData = users[currentUser];
  const matkulDosen = Array.isArray(userData.matkul) ? userData.matkul : [userData.matkul];
  
  if (matkulDosen.length === 0) {
    attendanceTables.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">
          <i class="fas fa-book"></i>
        </div>
        <h3>Tidak ada mata kuliah yang diampu</h3>
      </div>
    `;
    return;
  }
  
  matkulDosen.forEach(matkul => {
    const tableContainer = document.createElement('div');
    tableContainer.className = 'table-container';
    
    const tableTitle = document.createElement('h4');
    tableTitle.textContent = `${matkul}`;
    tableTitle.style.margin = '20px 0 10px';
    tableTitle.style.color = 'var(--primary)';
    
    const table = document.createElement('table');
    table.className = 'attendance-table';
    table.setAttribute('data-matkul', matkul);
    
    const thead = document.createElement('thead');
    thead.innerHTML = `
      <tr>
        <th>Nama Mahasiswa</th>
        ${Array.from({length: 16}, (_, i) => `<th>${i+1}</th>`).join('')}
      </tr>
    `;
    
    const tbody = document.createElement('tbody');
    
    Object.keys(users).forEach(username => {
      if (users[username].role === 'student') {
        const row = document.createElement('tr');
        row.setAttribute('data-student-id', username);
        
        const nameCell = document.createElement('td');
        nameCell.textContent = users[username].name;
        row.appendChild(nameCell);
        
        const hadirArr = attendanceData[username]?.[matkul]?.hadir || [];
        const tidakHadirArr = attendanceData[username]?.[matkul]?.tidakHadir || [];
        
        for(let p=1; p<=16; p++){
          const cell = document.createElement('td');
          cell.setAttribute('data-pertemuan', p);
          
          if(hadirArr.includes(p)){
            cell.textContent = "✔️";
            cell.className = 'present';
          } else if(tidakHadirArr.includes(p)){
            cell.textContent = "❌";
            cell.className = 'absent';
          } else {
            cell.textContent = "";
            cell.className = 'empty';
          }
          
          if (isEditing) {
            cell.classList.add('editable');
          }
          
          row.appendChild(cell);
        }
        
        tbody.appendChild(row);
      }
    });
    
    table.appendChild(thead);
    table.appendChild(tbody);
    tableContainer.appendChild(tableTitle);
    tableContainer.appendChild(table);
    attendanceTables.appendChild(tableContainer);
  });
  
  // Add edit button for lecturer
  if (!isEditing) {
    const editButton = document.createElement('button');
    editButton.className = 'btn btn-warning';
    editButton.style.marginTop = '20px';
    editButton.innerHTML = '<i class="fas fa-edit"></i> Edit Kehadiran';
    editButton.onclick = startEditAttendance;
    attendanceTables.appendChild(editButton);
  }
} else {
  // Tampilan untuk mahasiswa - hanya data dirinya sendiri
  const userData = users[currentUser];
  const nim = userData.nim;
  
  if (semuaMataKuliah.length === 0) {
    attendanceTables.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">
          <i class="fas fa-book"></i>
        </div>
        <h3>Tidak ada data mata kuliah</h3>
      </div>
    `;
    return;
  }
  
  const tableContainer = document.createElement('div');
  tableContainer.className = 'table-container';
  
  const table = document.createElement('table');
  table.className = 'attendance-table';
  
  const thead = document.createElement('thead');
  thead.innerHTML = `
    <tr>
      <th>Mata Kuliah</th>
      ${Array.from({length: 16}, (_, i) => `<th>${i+1}</th>`).join('')}
      <th>Total</th>
    </tr>
  `;
  
  const tbody = document.createElement('tbody');
  
  semuaMataKuliah.forEach(matkul => {
    const row = document.createElement('tr');
    
    const matkulCell = document.createElement('td');
    matkulCell.textContent = matkul;
    row.appendChild(matkulCell);
    
    const hadirArr = attendanceData[currentUser]?.[matkul]?.hadir || [];
    const tidakHadirArr = attendanceData[currentUser]?.[matkul]?.tidakHadir || [];
    let totalHadir = 0;
    
    for(let p=1; p<=16; p++){
      const cell = document.createElement('td');
      
      if(hadirArr.includes(p)){
        cell.textContent = "✔️";
        cell.className = 'present';
        totalHadir++;
      } else if(tidakHadirArr.includes(p)){
        cell.textContent = "❌";
        cell.className = 'absent';
      } else {
        cell.textContent = "";
        cell.className = 'empty';
      }
      
      row.appendChild(cell);
    }
    
    // Add total column
    const totalCell = document.createElement('td');
    totalCell.textContent = `${totalHadir}/16`;
    totalCell.style.fontWeight = '600';
    row.appendChild(totalCell);
    
    tbody.appendChild(row);
  });
  
  // Add summary row
  const summaryRow = document.createElement('tr');
  summaryRow.style.backgroundColor = '#f8f9fa';
  
  const summaryLabelCell = document.createElement('td');
  summaryLabelCell.textContent = 'Total Kehadiran';
  summaryLabelCell.style.fontWeight = '600';
  summaryRow.appendChild(summaryLabelCell);
  
  let totalAllHadir = 0;
  for(let p=1; p<=16; p++){
    const cell = document.createElement('td');
    cell.textContent = '';
    summaryRow.appendChild(cell);
  }
  
  const totalAllCell = document.createElement('td');
  const { totalHadir } = calculateStudentAttendance(nim);
  totalAllCell.textContent = `${totalHadir}/${semuaMataKuliah.length * 16}`;
  totalAllCell.style.fontWeight = '600';
  summaryRow.appendChild(totalAllCell);
  
  tbody.appendChild(summaryRow);
  
  table.appendChild(thead);
  table.appendChild(tbody);
  tableContainer.appendChild(table);
  attendanceTables.appendChild(tableContainer);
}

// Add click event for editable cells
if (isEditing) {
  document.querySelectorAll('.editable').forEach(cell => {
    cell.addEventListener('click', toggleAttendance);
  });
}
}

// Fungsi untuk menampilkan dashboard
async function showDashboard(user) {
updateDateTime();
document.getElementById('loginBox').style.display = 'none';
document.getElementById('dashboard').style.display = 'block';

text
// Get attendance data from Firebase
await getAttendanceData();

const userData = users[user];
const userRole = userData.role;
const userName = userData.name;
const userTitle = userData.title || '';
const userGreeting = userData.greeting || '';

// Set user info
document.getElementById('userGreeting').textContent = `${userGreeting} ${userName} ${userTitle}`;
document.getElementById('userRole').textContent = `${
  userRole === 'admin' ? 'Administrator' : 
  userRole === 'lecturer' ? 'Dosen' : 'Mahasiswa'
} - ${userData.nim || ''}`;

// Set avatar initial
document.getElementById('userAvatar').textContent = userName.charAt(0).toUpperCase();

// Render components based on role
renderInfoCards(userRole);
renderTodaySchedule(userRole);
renderAttendanceTables(userRole);
}

// Inisialisasi
setInterval(updateDateTime, 1000);
updateDateTime();

// Initialize click event for modal background
document.getElementById('attendanceModal').addEventListener('click', function(e) {
if (e.target === this) {
closeModal();
}
});
</script>

</body> </html> ```
